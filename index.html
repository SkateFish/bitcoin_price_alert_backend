<html>
<head>
<script src="/public/bower_components/appbase-js/browser/appbase.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<style>
#background-img {
    background: url(public/bitcoin_back.jpg);
}
</style>

</head>

<body style="" id="background-img">
<div class="row">
<div class="col-md-2">
</div>
<div class="col-md-8">

	<span style="color:#ffd700;"><h1><center><b>Bitcoin USD</b></center></h1></span>
  <div class="row well">
    <div class="col-md-2"></div>
    <div class="col-md-2"><input name="price" type="text" class="form-control" placeholder="Set Price" id="price"></input></div>
    <div class="col-md-4"><input name="email" type="text" class="form-control" placeholder="Email" id="email"></input></div>
    <div class="col-md-2"><button type="button" id="submit" class="btn btn-primary">Submit</button></div>
    <div class="col-md-1"></div>
  </div>

  <div class="row" id="notification_status">
  </div>

<div class="well">
	<div class="row">
    <label for="avg">Average of 24 Hours:</label>
    <p name="avg" type="text" class="form-control" id="avg"></p>
  </div>
  <div class="row">
    <label for="last">Last:</label>
    <p name="last" type="text" class="form-control" id="last"></p>
  </div>
  <div class="row">
    <label for="bid">Bid:</label>
    <p name="bid" type="text" class="form-control" id="bid"></p>
  </div>
  <div class="row">
    <label for="ask">Ask:</label>
    <p name="ask" type="text" class="form-control" id="ask"></p>
  </div>
  <div class="row">
    <label for="volume">Total Volume:</label>
    <p name="volume" type="text" class="form-control" id="volume"></p>
  </div>
  <div class="row">
    <label for="timestamp">Timestamp:</label>
    <span id="timestamp"></span>
  </div>
</div>

<div class="col-md-2">
</div>
</body>

<script>
var appbase = new Appbase({
  url: 'https://scalr.api.appbase.io',
  appname: 'testgsoc',
  username: 'JxGrCcfHZ',
  password: '1c46a541-98fa-404c-ad61-d41571a82e14'
});

appbase.streamDocument({
  type: "bitcoin_price",
  id: '1'
}).on('data', function(res) {
  var data = res._source;
  $('#avg').text(data.last);
  $('#last').text(data.last);
  $('#bid').text(data.bid);
  $('#ask').text(data.ask);
  $('#timestamp').text(data.timestamp);
  $('#volume').text(data.total_vol);
}).on('error', function(err) {
  console.log("streaming error: ", err);
});

$('#submit').on('click',function(){
  $('.alert').remove();
  if($('#price').val() == "" || $('#email').val() == ""){
    $('#notification_status').append('<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><center><strong>Warning!</strong> Please fille the details properly.</center></div>');
  }
  else{
  	$.ajax({
  		url: "/alerting", 
  		data: { 
          		"price": $('#price').val(), 
          		"email": $('#email').val()
      		}   
      });
    $('#notification_status').append('<div class="alert alert-success alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><center><strong>Price Set!</strong> You will get Email when Bitcoin price set to <b>'+$('#price').val()+'</center></div>');
    $('#price').val("");
    $('#price').val("");
  }
  
});

</script>

</html>
